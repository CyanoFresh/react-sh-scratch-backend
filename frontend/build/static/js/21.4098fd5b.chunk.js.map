{"version":3,"sources":["modules/variable/HistoryModal.js"],"names":["useStyles","makeStyles","theme","formControl","marginBottom","spacing","width","HistoryContent","_ref","history","id","core","name","suffix","classes","_useState","useState","_useState2","Object","D_JS_sh_frontend_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_2__","period","setPeriod","_useState3","_useState4","data","setData","_useState5","_useState6","isLoading","setIsLoading","_useState7","_useState8","error","setError","useMemo","_ref2","D_JS_sh_frontend_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__","D_JS_sh_frontend_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","a","mark","_callee","response","wrap","_context","prev","next","authenticatedRequest","url","concat","responseType","method","sent","ok","abrupt","t0","console","stop","apply","this","arguments","loadHistory","react__WEBPACK_IMPORTED_MODULE_12___default","createElement","_material_ui_core__WEBPACK_IMPORTED_MODULE_13__","_material_ui_core_Box__WEBPACK_IMPORTED_MODULE_14__","bgcolor","color","p","length","recharts__WEBPACK_IMPORTED_MODULE_15__","aspect","dataKey","tickFormatter","value","Date","toLocaleTimeString","domain","strokeDasharray","labelFormatter","toLocaleString","type","stroke","unit","isAnimationActive","Fragment","_material_ui_core_FormControl__WEBPACK_IMPORTED_MODULE_6__","className","_material_ui_core_InputLabel__WEBPACK_IMPORTED_MODULE_7__","htmlFor","_material_ui_core_Select__WEBPACK_IMPORTED_MODULE_8__","onChange","event","target","inputProps","_material_ui_core_MenuItem__WEBPACK_IMPORTED_MODULE_9__","HistoryModal","_ref3","open","onClose","useTheme","fullScreen","useMediaQuery","breakpoints","down","_material_ui_core_Dialog__WEBPACK_IMPORTED_MODULE_3__","fullWidth","maxWidth","aria-labelledby","_material_ui_core_DialogTitle__WEBPACK_IMPORTED_MODULE_4__","_material_ui_core_DialogContent__WEBPACK_IMPORTED_MODULE_5__","_material_ui_core_DialogActions__WEBPACK_IMPORTED_MODULE_10__","_material_ui_core_Button__WEBPACK_IMPORTED_MODULE_11__","onClick"],"mappings":"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","file":"static/js/21.4098fd5b.chunk.js","sourcesContent":["import Dialog from '@material-ui/core/Dialog';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport Select from '@material-ui/core/Select';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport Button from '@material-ui/core/Button';\r\nimport React, { useMemo, useState } from 'react';\r\nimport { CircularProgress } from '@material-ui/core';\r\nimport Box from '@material-ui/core/Box';\r\nimport { Area, AreaChart, CartesianGrid, Legend, ResponsiveContainer, Tooltip, XAxis, YAxis } from 'recharts';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\r\nimport { useTheme } from '@material-ui/core/styles';\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  formControl: {\r\n    marginBottom: theme.spacing(2),\r\n    width: '50%',\r\n  },\r\n}));\r\n\r\nfunction HistoryContent({ id, core, name, suffix }) {\r\n  const classes = useStyles();\r\n\r\n  const [period, setPeriod] = useState('6_hours');\r\n  const [data, setData] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  useMemo(() => {\r\n    const loadHistory = async () => {\r\n      setIsLoading(true);\r\n\r\n      try {\r\n        const response = await core.authenticatedRequest({\r\n          url: `/variable/${id}/history?period=${period}`,\r\n          responseType: 'json',\r\n          method: 'get',\r\n        });\r\n\r\n        setIsLoading(false);\r\n\r\n        if (!response.data.ok) {\r\n          return setError('Wrong server response');\r\n        }\r\n\r\n        setError(null);\r\n        setData(response.data.history);\r\n      } catch (e) {\r\n        setIsLoading(false);\r\n        setError('Cannot load history');\r\n\r\n        console.error(e);\r\n      }\r\n    };\r\n\r\n    loadHistory();\r\n  }, [\r\n    period,\r\n    id,\r\n    core,\r\n  ]);\r\n\r\n  let history;\r\n\r\n  if (isLoading) {\r\n    history = <div><CircularProgress/></div>;\r\n  } else if (error) {\r\n    history = (\r\n      <Box bgcolor=\"error.main\" color=\"background.paper\" p={2}>\r\n        {error}\r\n      </Box>\r\n    );\r\n  } else if (data && data.length) {\r\n    history = (\r\n      <ResponsiveContainer aspect={2}>\r\n        <AreaChart data={data}>\r\n          <XAxis dataKey=\"date\"\r\n                 tickFormatter={value => new Date(value * 1000).toLocaleTimeString()}/>\r\n          <YAxis domain={['dataMin - 5', 'dataMax + 5']}/>\r\n          <CartesianGrid strokeDasharray=\"3 3\"/>\r\n          <Tooltip labelFormatter={value => new Date(value * 1000).toLocaleString()}/>\r\n          <Legend/>\r\n          <Area type=\"monotone\" dataKey=\"value\" stroke=\"red\" name={name} unit={suffix} isAnimationActive={false}/>\r\n        </AreaChart>\r\n      </ResponsiveContainer>\r\n    );\r\n  } else {\r\n    history = (\r\n      <Box bgcolor=\"text.secondary\" color=\"background.paper\" p={2}>\r\n        No history for selected period\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <FormControl className={classes.formControl}>\r\n        <InputLabel htmlFor=\"historyPeriod\">Period</InputLabel>\r\n        <Select\r\n          value={period}\r\n          onChange={event => setPeriod(event.target.value)}\r\n          inputProps={{\r\n            name: 'historyPeriod',\r\n            id: 'historyPeriod',\r\n          }}\r\n        >\r\n          <MenuItem value=\"3_days\">3 days</MenuItem>\r\n          <MenuItem value=\"24_hours\">24 hours</MenuItem>\r\n          <MenuItem value=\"12_hours\">12 hours</MenuItem>\r\n          <MenuItem value=\"6_hours\">6 hours</MenuItem>\r\n          <MenuItem value=\"3_hours\">3 hours</MenuItem>\r\n        </Select>\r\n      </FormControl>\r\n\r\n      {history}\r\n    </React.Fragment>\r\n  );\r\n}\r\n\r\nconst HistoryModal = ({ id, name, suffix, open, onClose, core }) => {\r\n  const theme = useTheme();\r\n  const fullScreen = useMediaQuery(theme.breakpoints.down('sm'));\r\n\r\n  return (\r\n    <Dialog\r\n      open={open}\r\n      onClose={onClose}\r\n      fullScreen={fullScreen}\r\n      fullWidth\r\n      maxWidth={'md'}\r\n      aria-labelledby=\"variable-dialog-title\"\r\n    >\r\n      <DialogTitle id=\"variable-dialog-title\">History of {name}</DialogTitle>\r\n      <DialogContent>\r\n        <HistoryContent core={core} id={id} name={name} suffix={suffix}/>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={onClose} color=\"primary\">\r\n          Close\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default HistoryModal;\r\n"],"sourceRoot":""}